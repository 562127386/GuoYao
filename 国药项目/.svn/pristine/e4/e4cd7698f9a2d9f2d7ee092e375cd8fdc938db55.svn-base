@*------------------------------------------------------------------------------
    *     此代码由T4模板自动生成
    *	   生成时间 2018-12-06 18:24:38
    *     ©为之团队
    *------------------------------------------------------------------------------*@

@{
    ViewBag.Title = "病例信息录入";
    Layout = "~/Views/Shared/LayoutBui.cshtml";
}
<style>
    .bui-bar .add-bar-width {
        width: 1rem;
    }

        .bui-bar .add-bar-width .bui-btn {
            width: 1.1rem;
        }

    .add-bar-width .bui-btn .name {
        vertical-align: top;
    }

    .wrap-date {
        padding: .18rem;
        border: none;
    }

        .wrap-date .schedule-date .data-time {
            color: #333;
        }

        .wrap-date .schedule-date .data-time2 {
            padding: 0 .18rem 0 .09rem;
            color: #999;
            font-size: .2rem;
        }

        .wrap-date .schedule-date .date-today {
            display: inline-block;
            width: .4rem;
            height: .4rem;
            text-align: center;
            line-height: .4rem;
            color: #00aaff;
            border: 1px solid #00aaff;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
        }

        .wrap-date .schedule-week span {
            display: inline-block;
            width: .3rem;
            height: .3rem;
            font-size: .2rem;
            text-align: center;
            line-height: .3rem;
            border: 1px solid #00aaff;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
            color: #9a9a9a;
        }

        .wrap-date .schedule-week .week-active {
            color: #00aaff;
        }

    .date-lists {
        padding: 0 .18rem .18rem;
        border: none;
    }

        .date-lists .span1 span {
            display: block;
            text-align: center;
        }

        .date-lists .span1 .data-up {
            padding-bottom: .03rem;
        }

        .date-lists .span1 .data-down {
            margin: 0 auto;
            width: .55rem;
            height: .55rem;
            line-height: .58rem;
            color: #000;
            font-size: .3rem;
        }

        .date-lists .span1:last-child .data-down {
            color: #999;
        }

        .date-lists .span1 .active-data-down {
            background-color: #00aaff;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
            color: #fff !important;
        }

    .time-lists {
        margin-top: .18rem;
        padding: 0 .18rem .2rem .2rem;
        border-top: none;
        background-color: #fff;
    }

        .time-lists .bui-box {
            padding: 0.2rem 0 .2rem 0;
            ;
        }

        .time-lists .left-time {
            margin-right: .18rem;
            color: #666;
        }

        .time-lists .middle-content .item-title {
            color: #333;
        }

        .time-lists .middle-content .item-text {
            margin-bottom: 0;
            font-size: .18rem;
        }

        .time-lists .right-mark {
            width: .5rem;
            height: .5rem;
            text-align: center;
            line-height: .5rem;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
        }

        .time-lists .green-mark {
            color: #6ed046;
            border: 1px solid #6ed046;
        }

        .time-lists .yellow-mark {
            color: #ffad03;
            border: 1px solid #ffad03;
        }

    .add-mark {
        position: fixed;
        right: .23rem;
        bottom: .23rem;
        width: .8rem;
        height: .8rem;
        line-height: .8rem;
        text-align: center;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
        color: #fff;
        background-color: #52a4ff;
    }

        .add-mark .icon-plus {
            color: #fff;
            font-size: .44rem;
        }
</style>
<script>

    var page_jf = {
        //rows: 5,//每页行数
        page: 1,//当前页
        sidx: 'Id',//排序列
        sord: 'asc',//排序类型
        records: 0,//总记录数
        total: 0,//总页数
        LoadEnd: false
        //conditionJson:"1=1"
    }

    bui.ready(function () {

        //按钮在tab外层,需要传id
        var tab = bui.tab({
            id: "#tabDynamic",
            // 1: 声明是动态加载的tab
            autoload: true,
        })

        // 2: 监听加载后的事件, load 只加载一次
        tab.on("to", function (index) {
            if ($("#scrollSearch" + index + " ul.bui-list").html().length <= 0) {
                    loader.require([list(index)]);
            }
        }).to(0)

     

    })

    function list(index) {
        var queryJson = {};
        queryJson.status = index;
        var p = page_jf;
        queryJson = JSON.stringify(queryJson)
        var uiList = bui.list({
            id: "#scrollSearch" + index,
            url: "/GY/GY_BL/GetGridJson?queryJson=" + queryJson,
            data: page_jf,
            pageSize:5,
            //如果分页的字段名不一样,通过field重新定义
            field: {
                page: "page",
                size: "rows",
                data: "rows"
            },
            //callback: function (e) {
            //    // e.target 为你当前点击的元素
            //    // $(e.target).closest(".bui-btn") 可以找到你当前点击的一整行,可以把一些属性放这里
            //    console.log($(e.target).closest(".bui-btn").attr("class"))
            //},
            template: function (data) {
                var html = "";
                if (index == 0) {
                    for (var i = 0; i < data.length; i++) {

                        html += '<div class="section-title">' + data[i].hname + '</div>'
                               + '    <div class="bui-btn bui-box" onclick="updateBL(' + '\'' + data[i].Id + '\'' + ')" id = "updateBL">'
                               + '         <div class="span1">'
                               + '             <h3 class="item-title">' + data[i].operation + '</h3>'
                               + '             <p class="item-text">' + data[i].opertime + '</p>'
                               + '             <p class="item-text"><span class="bui-label">性别</span><span class="bui-value">' + data[i].psex + '</span></p>'
                               + '             <p class="item-text"><span class="bui-label">姓名</span><span class="bui-value">' + data[i].pname + '</span></p>'
                               + '         </div>'
                               + '         <i class="icon-listright"></i>'
                               + '     </div>'
                    }
                    //$("#ToAudit").html();
                    return html;
                    //$("#ToAudit").html(html);
                }
                else if (index == 1) {
                    for (var i = 0; i < data.length; i++) {

                        html += '<div class="section-title">' + data[i].hname + '</div>'
                               + '    <div class="bui-btn bui-box" id = "updateBL">'
                               + '         <div class="span1">'
                               + '             <h3 class="item-title">' + data[i].operation + '</h3>'
                               + '             <p class="item-text">' + data[i].opertime + '</p>'
                               + '             <p class="item-text"><span class="bui-label">性别</span><span class="bui-value">' + data[i].psex + '</span></p>'
                               + '             <p class="item-text"><span class="bui-label">姓名</span><span class="bui-value">' + data[i].pname + '</span></p>'
                               + '         </div>'
                               + '         <i class="icon-listright"></i>'
                               + '     </div>'
                    }
                    //$("#through").html();
                    return html;
                    //$("#through").html(html);
                    //$("#updateBL").removeAttr("onclick");
                }
                else if (index == 2) {
                    for (var i = 0; i < data.length; i++) {

                        html += '<div class="section-title">' + data[i].hname + '</div>'
                               + '    <div class="bui-btn bui-box" onclick="updateBL(' + '\'' + data[i].Id + '\'' + ')" id = "updateBL">'
                               + '         <div class="span1">'
                               + '             <h3 class="item-title">' + data[i].operation + '</h3>'
                               + '             <p class="item-text">' + data[i].opertime + '</p>'
                               + '             <p class="item-text"><span class="bui-label">性别</span><span class="bui-value">' + data[i].psex + '</span></p>'
                               + '             <p class="item-text"><span class="bui-label">姓名</span><span class="bui-value">' + data[i].pname + '</span></p>'
                               + '         </div>'
                               + '         <i class="icon-listright"></i>'
                               + '     </div>'
                    }
                    //$("#unThrough").html();
                    return html;
                    //$("#unThrough").html(html);
                }
            }
        });
        return uiList;


    }

    //修改病例信息
    function updateBL(keyValue) {
        $(location).attr('href', '/GY/GY_M/GY_BLForm_m?keyValue=' + keyValue);
    }

    var pageview = {};

    bui.ready(function () {

        // 执行初始化
        pageview.init();
    })

    pageview.bind = function () {

        //初始化页面的链接跳转
        bui.btn({ id: "#page", handle: ".bui-btn" }).load();

    }
    pageview.init = function () {

        //下拉菜单 在顶部中间
        var barMain = bui.dropdown({
            id: "#barMain",
            showArrow: true,
            relative: false
        })
        // 下拉菜单有遮罩的情况
        var uiMask = bui.mask({
            zIndex: 9
        });

        // 通过监听事件绑定
        barMain.on("show", function () {
            uiMask.show();
        })
        barMain.on("hide", function () {
            uiMask.hide();
        })

        this.bind();
    }
</script>
    <div class="bui-page" id="page">
        <header class="bui-bar">
            <div class="bui-bar-left add-bar-width">
                <a class="bui-btn" onclick="bui.back();">
                    <i class="icon-back"></i>
                </a>
            </div>
            <div class="bui-bar-main">
                病例信息
            </div>
            <div class="bui-bar-right">
                <a class="bui-btn" href="/GY/GY_M/GY_BLForm_m">
                    <i class="icon-plus"></i>
                </a>
            </div>
        </header>
        <main>
            <div id="tabDynamic" class="bui-tab">
                <div class="bui-tab-head">
                    <ul class="bui-nav">
                    <li class="bui-btn">待审核</li>
                    <li class="bui-btn">已通过</li>
                    <li class="bui-btn">未通过</li>
                    </ul>
                </div>
                <div class="bui-tab-main">
                            <ul>
                    <li id="ToAudit">
                                    <div id="scrollSearch0" class="bui-scroll">
                                        <div class="bui-scroll-head"></div>
                                        <div class="bui-scroll-main">
                                            <ul class="bui-list"></ul>
                                        </div>
                                        <div class="bui-scroll-foot"></div>
                                    </div>  
                                    <!-- 待审核 -->
                                </li>
                                <li style="display: none;" id="through">
                                    <div id="scrollSearch1" class="bui-scroll">
                                        <div class="bui-scroll-head"></div>
                                        <div class="bui-scroll-main">
                                            <ul class="bui-list"></ul>
                                        </div>
                                        <div class="bui-scroll-foot"></div>
                                    </div>  
                                    <!-- 已通过 -->
                                </li>
                                <li style="display: none;" id="unThrough">
                                    <div id="scrollSearch2" class="bui-scroll">
                                        <div class="bui-scroll-head"></div>
                                        <div class="bui-scroll-main">
                                            <ul class="bui-list"></ul>
                                        </div>
                                        <div class="bui-scroll-foot"></div>
                                    </div>  
                                    <!-- 未通过 -->
                                </li>
                            </ul>
                        <div class="bui-scroll-foot"></div>
                    </div>
                </div>
            <a href="/GY/GY_M/GY_BLForm_m">
                <div class="add-mark">
                    <i class="icon-plus"></i>
                </div>
            </a>
        </main>
    </div>


